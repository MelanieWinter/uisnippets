{% extends 'base.html' %}
{% block content %}
    <!-- <h1>Add a Snippet</h1> -->
    <!-- {% if object %}
        <h1>Edit <span class="teal-text">{{ object.title }}</span></h1>
    {% else %}
        <h1>Add An Element</h1>
    {% endif %} -->

    <div class="whole-form-container">
        <form action="" method="POST">
        <div class="top-form-container">
                <!-- #id_title -->
                <div class="form-title">
                    <div>
                    <label for="{{ form.title.id_for_label }}" id="title-label">Title</label>
                    {{ form.title }}
                    </div>
                    <div>
                        <label for="{{ form.description.id_for_label }}" id="description-label">Description</label>
                        {{form.description}}
                    </div>
                </div>
                <div class="form-buttons">
                    <input type="submit" value="Submit" class="btn white-text" id="submit-btn">
                </div>
        </div>
    
        <div class="container">
            <div class="left-c">
                    {% csrf_token %}
                    <!-- #id_html_code -->
                    <label for="{{ form.html_code.id_for_label }}"><i class="fa-brands fa-html5"></i> HTML</label>
                    {{form.html_code}}
    
                    <!-- #id_css_code -->
                    <label for="{{ form.css_code.id_for_label }}"><i class="fa-brands fa-css3-alt"></i> CSS</label>
                    {{form.css_code}}
    
                    <!-- id_js_code -->
                    <label for="{{ form.js_code.id_for_label }}"><i class="fa-brands fa-js"></i> JS</label>
                    {{form.js_code}}
                </form>
            </div>
            <div class="right-c">
                <div>
                    <label><i class="fa-solid fa-play"></i> Output</label>
                    <iframe id="output"></iframe>
                </div>
                
                <div class="snippet-tag-div">
                    {% if snippet.tags.count %}
                        {% for tag in snippet.tags.all %}
                        <div>
                            <a href="{% url 'tags_detail' tag.id %}">
                                <button class="tag">{{tag.name}}</button>
                            </a>
                        </div>
                        <div>
                            <form method="POST" action="{% url 'remove_tag' snippet.id tag.id %}">
                                {% csrf_token %}
                                <button type="submit">Remove</button>
                            </form>
                        </div>
                        {% endfor %}
                    {% else %}
                        <h5>No Tags</h5>
                    {% endif %}
                </div>
    
                <div>
                    <h5>add a tag</h5>
                    <div>
                        {% if tags_not_in_snippet %}
                            {% for tag in tags_not_in_snippet %}
                                <form method="POST" action="{% url 'assoc_tag' snippet.id tag.id %}">
                                    {% csrf_token %}
                                    <button type="submit" class="tag">{{tag.name}}</button>
                                </form>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>
                
            </div>
        </div>
    </div>

    

    <script>
        // HTML
        const htmlEditor = CodeMirror.fromTextArea(document.getElementById("id_html_code"), {
            mode: "xml",
            lineNumbers: true,
            // theme: 'monokai',
            autoCloseTags: true,
            autoCloseBrackets: true,
            extraKeys: { "Ctrl-Space": "autocomplete" }
        });

        // CSS
        const cssEditor = CodeMirror.fromTextArea(document.getElementById("id_css_code"), {
            mode: "css",
            lineNumbers: true,
            autoCloseBrackets: true,
            // theme: 'monokai',
            extraKeys: { "Ctrl-Space": "autocomplete" }
        });

        // JavaScript
        const jsEditor = CodeMirror.fromTextArea(document.getElementById("id_js_code"), {
            mode: "javascript",
            lineNumbers: true,
            autoCloseBrackets: true,
            // theme: 'monokai',
            extraKeys: { "Ctrl-Space": "autocomplete" }
        });

        // Event listeners for user input
        htmlEditor.on("change", run);
        cssEditor.on("change", run);
        jsEditor.on("change", run);

        const output = document.getElementById('output');

        function run() {
            let htmlVal = htmlEditor.getValue();
            let cssVal = cssEditor.getValue();
            let jsVal = jsEditor.getValue();

            // Update the content of the output iframe
            output.contentDocument.body.innerHTML = htmlVal + '<style>' + cssVal + '</style>';
            output.contentWindow.eval(jsVal);
        }

        const selectEl = document.getElementById('id_primary_code_type');
        M.FormSelect.init(selectEl);
    </script>
    
{% endblock %}


